function import$(e,t){var r={}.hasOwnProperty;for(var n in t)r.call(t,n)&&(e[n]=t[n]);return e}var x$;x$=angular.module("ogr"),x$.controller("data",["$scope","$http"].concat(function(e,t){return e.loading=!0,e.score={set:function(e,t){return this.values[e]=this.values[e]===t?0:t},values:{},send:function(){return t({url:"/d/score",method:"POST",data:{payload:this.values}}).then(function(){return console.log("ok")})["catch"](function(e){return console.log(e)})}},e.clsmap={"政策基礎":"context","資料集":"dataset","影響力":"impact"},d3.csv("/assets/data/detail.csv",function(r){var n,o,a,c,u,i,s,l,d,f,h;r=d3.nest().key(function(e){return e["資料集類別"]}).rollup(function(e){var t,r,n,o,a,c,u,i,s,l;for(t=function(){var t=[];for(r in e[0])t.push(r);return t}().filter(function(e){return/^\d+\./.exec(e)}),n={},o=0,a=t.length;a>o;++o)for(c=t[o],u=c.replace(/^\d+\.\s*/,""),n[u]=0,i=0,s=e.length;s>i;++i)l=e[i],n[u]=n[u]+ +l[c];for(o=0,a=t.length;a>o;++o)c=t[o],u=c.replace(/^\d+\.\s*/,""),n[u]=Math.round(100*n[u]/e.length);return n}).entries(r),r.map(function(e){return e.img=e.key.split(" ")[0]}),console.log(r),o=[];for(a in r[0].values)o.push(a);for(n=o,o=[],u=0,i=n.length;i>u;++u){for(s=n[u],l={name:s},d=0,f=r.length;f>d;++d)h=r[d],l[h.key]={value:h.values[s],rank:Math.floor(h.values[s]/33.33)};o.push(l)}return c=o,e.$apply(function(){return e.table=c,e.detail=r}),d3.csv("/assets/data/score.csv",function(r){function n(){var e,t=[];for(s in e=i)l=e[s],t.push(l);return t}function o(e,t){return e+t.sum}var a,c,u,i,s,l,d,f,h,m,p,g,x,v,k,y,S,w,A,b,$;setTimeout(function(){return document.querySelector("#root").setAttribute("class","ld ld-over-full-inverse")},1e3),a={danger:"#ff5135",success:"#00f2c1",primary:"#00b4ed",warning:"#ffdc6c",info:"#e285ff"},c=d3.nest().key(function(e){return e.Category}).key(function(e){return e["Sub-category"]}).rollup(function(e){var t,r;return t=e.reduce(function(e,t){return e+ +t["Weighted Score"]},0),r=e.reduce(function(e,t){return e+ +t.Weight.replace("%","")},0),{values:e,sum:t,sum2:r,score:.01*Math.round(1e4*t/r)}}).map(r);for(u in c){i=c[u],i.sum=n().reduce(o,0);for(s in i)l=i[s],l.subscore=100*l.sum/(i.sum||1)}for(d=d3.nest().key(function(e){return e.Category}).map(r),f=d3.nest().key(function(e){return e["Sub-category"]}).rollup(function(e){var t;return t=e.reduce(function(e,t){return e+ +t["Weighted Score"]},0),{values:e,sum:t}}).entries(r),h=0,m=f.length;m>h;++h)p=f[h],p["總計"]=Math.round(100*p.values.sum)/100;for(e.$apply(function(){return e.subcats=f}),g={radar:plotdb.chart.get("Radar Chart"),column:plotdb.chart.get("Column Chart"),gradar:plotdb.chart.get("grouped radar chart"),line:plotdb.chart.get("Line Chart - OGR edition")},x={gridShow:!1,xAxisShow:!0,yAxisShow:!1,xAxisTickDirection:"vertical",xAxisHandleOverlap:"none",xAxisTickSizeInner:0,xAxisTickSizeOuter:0,fontSoze:10,xAxisStroke:"#f92",fill:"#f92",labelShow:!1},v={gridStroke:"#ddd",gridBackground:"none",gridDashArray:"1 0",gridStrokeWidth:.5,margin:30,nodeFill:"#fff",stroke:a.danger,nodeSize:10,legendShow:!0,palette:{colors:[{hex:"#00f2c1",keyword:"政策基礎"},{hex:"#ffdc6c",keyword:"資料集"},{hex:"#e285ff",keyword:"影響力"},{hex:"#e354f0",keyword:"其它"}]},aAxisShow:!0,rAxisShow:!1},k={palette:{colors:[{hex:"#ccc",keyword:"報告分數"},{hex:"#f73d7e",keyword:"您的評分"},{hex:"#00f2c1",keyword:"網友平均"}]},yAxisShowDomain:!1,gridShow:!1,xAxisTickDirection:"vertical",xAxisHandleOverlap:"none",xAxisTickCount:15},g.context=g.column.clone(),g.dataset=g.column.clone(),g.impact=g.column.clone(),y=[["context","政策基礎"],["dataset","資料集"],["impact","影響力"]].map(function(e){var t,r;return[e,function(){var n,o=[];for(t in n=c[e[1]])r=n[t],o.push({k:t,v:r});return o}().filter(function(e){return"sum"!==e.k}).map(function(t){return t.v.name=t.k,t.v.cat=e[1],t.v})]}),y.map(function(e){return g[e[0][0]].data(e[1],!1,{value:["score"],order:["name"]})}),g.gradar.data(y.reduce(function(e,t){return e.concat(t[1])},[]),!1,{radius:["score"],name:["name"],category:["cat"]}),t({url:"/d/score/mean",method:"GET"}).then(function(){})["catch"](function(){}),w=[],h=0;15>h;++h)A=h,w.push({"報告分數":Math.round(2*Math.random()+A/15),"您的評分":Math.round(5*Math.random()+A/15),"網友平均":Math.round(5*Math.random()+A/15),name:"I"+(A+1)});return S=w,g.line.data(S,!1,{value:["報告分數","您的評分","網友平均"],order:["name"]}),g.gradar.config(v),g.context.config((b=import$({},x),b.fill=a.success,b.xAxisStroke=a.success,b)),g.dataset.config((b=import$({},x),b.fill=a.warning,b.xAxisStroke=a.warning,b)),g.impact.config((b=import$({},x),b.fill=a.info,b.xAxisStroke=a.info,b)),g.line.config(import$({},k)),g.gradar.attach("#chart-attr"),g.context.attach("#chart-context"),g.dataset.attach("#chart-dataset"),g.impact.attach("#chart-impact"),g.line.attach("#feedback-line"),$=function(e,t){return document.querySelector(e).innerText=Math.round(t)},$("#sum-context .score",c["政策基礎"].sum),$("#sum-dataset .score",c["資料集"].sum),$("#sum-impact .score",c["影響力"].sum),e.$apply(function(){return e.loading=!1})})})}));