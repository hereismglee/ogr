function import$(e,r){var t={}.hasOwnProperty;for(var n in r)t.call(r,n)&&(e[n]=r[n]);return e}var x$;x$=angular.module("ogr"),x$.controller("data",["$scope"].concat(function(e){return e.loading=!0,e.clsmap={"政策基礎":"context","資料集":"dataset","影響力":"impact"},d3.csv("/assets/data/detail.csv",function(r){var t,n,a,o,c,u,i,s,d,l,f;r=d3.nest().key(function(e){return e["資料集類別"]}).rollup(function(e){var r,t,n,a,o,c,u,i,s,d;for(r=function(){var r=[];for(t in e[0])r.push(t);return r}().filter(function(e){return/^\d+\./.exec(e)}),n={},a=0,o=r.length;o>a;++a)for(c=r[a],u=c.replace(/^\d+\.\s*/,""),n[u]=0,i=0,s=e.length;s>i;++i)d=e[i],n[u]=n[u]+ +d[c];for(a=0,o=r.length;o>a;++a)c=r[a],u=c.replace(/^\d+\.\s*/,""),n[u]=Math.round(100*n[u]/e.length);return n}).entries(r),r.map(function(e){return e.img=e.key.split(" ")[0]}),console.log(r),n=[];for(a in r[0].values)n.push(a);for(t=n,n=[],c=0,u=t.length;u>c;++c){for(i=t[c],s={name:i},d=0,l=r.length;l>d;++d)f=r[d],s[f.key]={value:f.values[i],rank:Math.floor(f.values[i]/33.33)};n.push(s)}return o=n,e.$apply(function(){return e.table=o,e.detail=r}),d3.csv("/assets/data/score.csv",function(r){function t(){var e,r=[];for(i in e=u)s=e[i],r.push(s);return r}function n(e,r){return e+r.sum}var a,o,c,u,i,s,d,l,f,h,m,p,g,x,v,k,y,S,w,A,b;setTimeout(function(){return document.querySelector("#root").setAttribute("class","ld ld-over-full-inverse")},1e3),a={danger:"#ff5135",success:"#00f2c1",primary:"#00b4ed",warning:"#ffdc6c",info:"#e285ff"},o=d3.nest().key(function(e){return e.Category}).key(function(e){return e["Sub-category"]}).rollup(function(e){var r,t;return r=e.reduce(function(e,r){return e+ +r["Weighted Score"]},0),t=e.reduce(function(e,r){return e+ +r.Weight.replace("%","")},0),{values:e,sum:r,sum2:t,score:.01*Math.round(1e4*r/t)}}).map(r);for(c in o){u=o[c],u.sum=t().reduce(n,0);for(i in u)s=u[i],s.subscore=100*s.sum/(u.sum||1)}for(d=d3.nest().key(function(e){return e.Category}).map(r),l=d3.nest().key(function(e){return e["Sub-category"]}).rollup(function(e){var r;return r=e.reduce(function(e,r){return e+ +r["Weighted Score"]},0),{values:e,sum:r}}).entries(r),f=0,h=l.length;h>f;++f)m=l[f],m["總計"]=Math.round(100*m.values.sum)/100;for(e.$apply(function(){return e.subcats=l}),p={radar:plotdb.chart.get("Radar Chart"),column:plotdb.chart.get("Column Chart"),gradar:plotdb.chart.get("grouped radar chart"),line:plotdb.chart.get("Line Chart - OGR edition")},g={gridShow:!1,xAxisShow:!0,yAxisShow:!1,xAxisTickDirection:"vertical",xAxisHandleOverlap:"none",xAxisTickSizeInner:0,xAxisTickSizeOuter:0,fontSoze:10,xAxisStroke:"#f92",fill:"#f92",labelShow:!1},x={gridStroke:"#ddd",gridBackground:"none",gridDashArray:"1 0",gridStrokeWidth:.5,margin:30,nodeFill:"#fff",stroke:a.danger,nodeSize:10,legendShow:!0,palette:{colors:[{hex:"#00f2c1",keyword:"政策基礎"},{hex:"#ffdc6c",keyword:"資料集"},{hex:"#e285ff",keyword:"影響力"},{hex:"#e354f0",keyword:"其它"}]},aAxisShow:!0,rAxisShow:!1},v={palette:{colors:[{hex:"#ccc",keyword:"報告分數"},{hex:"#f73d7e",keyword:"您的評分"},{hex:"#00f2c1",keyword:"網友平均"}]},yAxisShowDomain:!1,gridShow:!1,xAxisTickDirection:"vertical",xAxisHandleOverlap:"none",xAxisTickCount:15},p.context=p.column.clone(),p.dataset=p.column.clone(),p.impact=p.column.clone(),k=[["context","政策基礎"],["dataset","資料集"],["impact","影響力"]].map(function(e){var r,t;return[e,function(){var n,a=[];for(r in n=o[e[1]])t=n[r],a.push({k:r,v:t});return a}().filter(function(e){return"sum"!==e.k}).map(function(r){return r.v.name=r.k,r.v.cat=e[1],r.v})]}),k.map(function(e){return p[e[0][0]].data(e[1],!1,{value:["score"],order:["name"]})}),p.gradar.data(k.reduce(function(e,r){return e.concat(r[1])},[]),!1,{radius:["score"],name:["name"],category:["cat"]}),S=[],f=0;15>f;++f)w=f,S.push({"報告分數":Math.round(2*Math.random()+w/15),"您的評分":Math.round(5*Math.random()+w/15),"網友平均":Math.round(5*Math.random()+w/15),name:"I"+(w+1)});return y=S,p.line.data(y,!1,{value:["報告分數","您的評分","網友平均"],order:["name"]}),p.gradar.config(x),p.context.config((A=import$({},g),A.fill=a.success,A.xAxisStroke=a.success,A)),p.dataset.config((A=import$({},g),A.fill=a.warning,A.xAxisStroke=a.warning,A)),p.impact.config((A=import$({},g),A.fill=a.info,A.xAxisStroke=a.info,A)),p.line.config(import$({},v)),p.gradar.attach("#chart-attr"),p.context.attach("#chart-context"),p.dataset.attach("#chart-dataset"),p.impact.attach("#chart-impact"),p.line.attach("#feedback-line"),b=function(e,r){return document.querySelector(e).innerText=Math.round(r)},b("#sum-context .score",o["政策基礎"].sum),b("#sum-dataset .score",o["資料集"].sum),b("#sum-impact .score",o["影響力"].sum),e.$apply(function(){return e.loading=!1})})})}));