function import$(e,t){var r={}.hasOwnProperty;for(var n in t)r.call(t,n)&&(e[n]=t[n]);return e}var x$;x$=angular.module("ogr"),x$.controller("data",["$scope","$http"].concat(function(e,t){return e.loading=!0,e.score={init:function(){var e=this;return t({url:"/d/score/mean",method:"GET"}).then(function(t){return e.mean=t.data})["catch"](function(e){return console.log(e)})},mean:null,set:function(e,t){return this.values[e]=this.values[e]===t?0:t},values:{},send:function(){return t({url:"/d/score",method:"POST",data:{payload:this.values}}).then(function(){return console.log("ok")})["catch"](function(e){return console.log(e)})}},e.clsmap={"政策基礎":"context","資料集":"dataset","影響力":"impact"},d3.csv("/assets/data/detail.csv",function(t){var r,n,o,a,c,u,i,s,l,d,f;t=d3.nest().key(function(e){return e["資料集類別"]}).rollup(function(e){var t,r,n,o,a,c,u,i,s,l;for(t=function(){var t=[];for(r in e[0])t.push(r);return t}().filter(function(e){return/^\d+\./.exec(e)}),n={},o=0,a=t.length;a>o;++o)for(c=t[o],u=c.replace(/^\d+\.\s*/,""),n[u]=0,i=0,s=e.length;s>i;++i)l=e[i],n[u]=n[u]+ +l[c];for(o=0,a=t.length;a>o;++o)c=t[o],u=c.replace(/^\d+\.\s*/,""),n[u]=Math.round(100*n[u]/e.length);return n}).entries(t),t.map(function(e){return e.img=e.key.split(" ")[0]}),console.log(t),n=[];for(o in t[0].values)n.push(o);for(r=n,n=[],c=0,u=r.length;u>c;++c){for(i=r[c],s={name:i},l=0,d=t.length;d>l;++l)f=t[l],s[f.key]={value:f.values[i],rank:Math.floor(f.values[i]/33.33)};n.push(s)}return a=n,e.$apply(function(){return e.table=a,e.detail=t}),d3.csv("/assets/data/score.csv",function(t){function r(){var e,t=[];for(i in e=u)s=e[i],t.push(s);return t}function n(e,t){return e+t.sum}var o,a,c,u,i,s,l,d,f,h,m,g,p,x,v,k,y,S,w,A,b;setTimeout(function(){return document.querySelector("#root").setAttribute("class","ld ld-over-full-inverse")},1e3),o={danger:"#ff5135",success:"#00f2c1",primary:"#00b4ed",warning:"#ffdc6c",info:"#e285ff"},a=d3.nest().key(function(e){return e.Category}).key(function(e){return e["Sub-category"]}).rollup(function(e){var t,r;return t=e.reduce(function(e,t){return e+ +t["Weighted Score"]},0),r=e.reduce(function(e,t){return e+ +t.Weight.replace("%","")},0),{values:e,sum:t,sum2:r,score:.01*Math.round(1e4*t/r)}}).map(t);for(c in a){u=a[c],u.sum=r().reduce(n,0);for(i in u)s=u[i],s.subscore=100*s.sum/(u.sum||1)}for(l=d3.nest().key(function(e){return e.Category}).map(t),d=d3.nest().key(function(e){return e["Sub-category"]}).rollup(function(e){var t;return t=e.reduce(function(e,t){return e+ +t["Weighted Score"]},0),{values:e,sum:t}}).entries(t),f=0,h=d.length;h>f;++f)m=d[f],m["總計"]=Math.round(100*m.values.sum)/100;for(e.$apply(function(){return e.subcats=d}),g={radar:plotdb.chart.get("Radar Chart"),column:plotdb.chart.get("Column Chart"),gradar:plotdb.chart.get("grouped radar chart"),line:plotdb.chart.get("Line Chart - OGR edition")},p={gridShow:!1,xAxisShow:!0,yAxisShow:!1,xAxisTickDirection:"vertical",xAxisHandleOverlap:"none",xAxisTickSizeInner:0,xAxisTickSizeOuter:0,fontSoze:10,xAxisStroke:"#f92",fill:"#f92",labelShow:!1},x={gridStroke:"#ddd",gridBackground:"none",gridDashArray:"1 0",gridStrokeWidth:.5,margin:30,nodeFill:"#fff",stroke:o.danger,nodeSize:10,legendShow:!0,palette:{colors:[{hex:"#00f2c1",keyword:"政策基礎"},{hex:"#ffdc6c",keyword:"資料集"},{hex:"#e285ff",keyword:"影響力"},{hex:"#e354f0",keyword:"其它"}]},aAxisShow:!0,rAxisShow:!1},v={palette:{colors:[{hex:"#ccc",keyword:"報告分數"},{hex:"#f73d7e",keyword:"您的評分"},{hex:"#00f2c1",keyword:"網友平均"}]},yAxisShowDomain:!1,gridShow:!1,xAxisTickDirection:"vertical",xAxisHandleOverlap:"none",xAxisTickCount:15},g.context=g.column.clone(),g.dataset=g.column.clone(),g.impact=g.column.clone(),k=[["context","政策基礎"],["dataset","資料集"],["impact","影響力"]].map(function(e){var t,r;return[e,function(){var n,o=[];for(t in n=a[e[1]])r=n[t],o.push({k:t,v:r});return o}().filter(function(e){return"sum"!==e.k}).map(function(t){return t.v.name=t.k,t.v.cat=e[1],t.v})]}),k.map(function(e){return g[e[0][0]].data(e[1],!1,{value:["score"],order:["name"]})}),g.gradar.data(k.reduce(function(e,t){return e.concat(t[1])},[]),!1,{radius:["score"],name:["name"],category:["cat"]}),S=[],f=0;15>f;++f)w=f,S.push({"報告分數":Math.round(2*Math.random()+w/15),"您的評分":Math.round(5*Math.random()+w/15),"網友平均":Math.round(5*Math.random()+w/15),name:"I"+(w+1)});return y=S,g.line.data(y,!1,{value:["報告分數","您的評分","網友平均"],order:["name"]}),g.gradar.config(x),g.context.config((A=import$({},p),A.fill=o.success,A.xAxisStroke=o.success,A)),g.dataset.config((A=import$({},p),A.fill=o.warning,A.xAxisStroke=o.warning,A)),g.impact.config((A=import$({},p),A.fill=o.info,A.xAxisStroke=o.info,A)),g.line.config(import$({},v)),g.gradar.attach("#chart-attr"),g.context.attach("#chart-context"),g.dataset.attach("#chart-dataset"),g.impact.attach("#chart-impact"),g.line.attach("#feedback-line"),b=function(e,t){return document.querySelector(e).innerText=Math.round(t)},b("#sum-context .score",a["政策基礎"].sum),b("#sum-dataset .score",a["資料集"].sum),b("#sum-impact .score",a["影響力"].sum),e.$apply(function(){return e.loading=!1}),e.score.init().then(function(){})})})}));